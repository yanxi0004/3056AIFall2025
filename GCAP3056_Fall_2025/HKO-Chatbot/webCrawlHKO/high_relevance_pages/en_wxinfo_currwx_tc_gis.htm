<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <title>Tropical cyclone track information - GIS version｜Hong Kong Observatory(HKO)｜Tropical Cyclone</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="Tropical Cyclone Track, Typhoon Track, Track Map, Past Track, Forecast Track, Potential Track Area">
    <meta name="description" content="When a tropical cyclone forms within or enters the area bounded by 7-36N and 100-140E, the Observatory will issue the first tropical cyclone track within two hours.">
    <meta name="recordId" content="2018123100000035907">
    <meta name="lang" content="en">
	<meta property="fb:app_id" content="468280339992518" />
	<meta property="og:type" content="website" />
	<meta property="og:title" content="ropical cyclone track information - GIS version" />
	<meta property="og:description" content="When a tropical cyclone forms within or enters the area bounded by 7-36N and 100-140E, the Observatory will issue the first tropical cyclone track within two hours." />
	<meta property="og:image" content="https://www.hko.gov.hk" />
	<meta property="og:url" content="https://www.hko.gov.hk/en/103397/Tropical-cyclone-track-information---GIS-version" />
	<meta property="og:image:width" content="600" />
	<meta property="og:image:height" content="314" />
    <!-- Bootstrap -->
    <link id="styleSheet0" href="/css/bootstrap.css" rel="stylesheet" media="screen" type="text/css">
    <link id="styleSheet1" href="/css/bsplus.css" rel="stylesheet" media="all" type="text/css">
    <link id="styleSheet2" href="/css/default.css" rel="stylesheet" media="screen" type="text/css">
    <link id="styleSheet3" href="/css/layout.css" rel="stylesheet" media="all" type="text/css">
    <link href="/css/flexslider.css" rel="stylesheet" media="all" type="text/css">
    <link href="/css/jquery-ui.min.css" rel="stylesheet" media="all" type="text/css">
    <style type="text/css">
.abc{
display: none;
}
		.headerArea:after {
    background-image: url(/images/setion_banner/satc.jpg);
}
#table_header_icon>tbody>tr>td:nth-child(odd){
    width:99.5% !important;
}
#table_header_icon>tbody>tr>td:nth-child(even){
    width:0.5% !important;
}
#table_header_icon table{
    float: right;
}
#tc_desc>table:nth-child(1){
    max-width:535px;
}

@media screen and (max-width: 767px) {
    #table_header_icon table{
        float: unset !important;
        margin: 0 auto !important;
    }
}

/* add by eric */
.div_responsive_table_1 {
    width: 100% !important;
}

.div_responsive_table_1>table {
    min-width: 100px !important;
}

@media screen and (max-width: 767px) {
    .row2_table tr td {
        display: block;
        width: 100% !important;
    }
    
    .self_row2_table>tr>td, .self_row2_table>tbody>tr>td {
        display: block;
        width: auto!important;
    }
}

/*.olFramedCloudPopupContent > table{
    margin-top: 6px;
    margin-left: 19px;
}*/

div.olFramedCloudPopupContent table {
    /*width:100%;
    height:100%*/
    min-width: 340px;
}

div.olFramedCloudPopupContent th{
    text-align: left;
}

.olFramedCloudPopupContent table{
	display: table;
    border-collapse: separate;
    border-spacing: 2px;
}

.olPopup>div>div>img {
	max-width: unset;
}

@media screen and (max-width: 676px) {
    div.olFramedCloudPopupContent table {
        min-width: unset;
    }
}

.coastline {
    filter: brightness(0);
}
    </style>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:/ -->
    <!--[if lt IE 9]>
    <script type="text/javascript" src="js/html5shiv.js"></script>
    <script type="text/javascript" src="js/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script type="text/javascript" src="/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="/js/jquery.cookie.js"></script>
    <script type="text/javascript" src="/js/jquery.easing.js"></script>
    <script type="text/javascript" src="/js/jquery.flexslider.js"></script>
    <script type="text/javascript" src="/js/menu.js"></script>
    <script type="text/javascript" src="/js/bootstrap.js"></script>

	<script type="text/javascript" src="/js/moment.js"></script>
	<script type="text/javascript" src="/js/vue.min.js"></script>
	<script type="text/javascript" src="/js/vue-router.js"></script>
	<script type="text/javascript" src="/js/vue-extend.js"></script>
	<script type="text/javascript" src="/js/tmp.js"></script>
	<script type="text/javascript" src="/js/jquery.rwdImageMaps.min.js"></script>


    <script type="text/javascript">
		
var menu_id = '32';
var section_id = '2018010100000010786';


try{checkseolink(103397);}catch(e){}                                                                                var menu_bar_title = "GIS Version";

 
$(document).ready(function(){
	insert_tcid_2_href();
	resetsize();
	
	/* add by eric */
	$('#divTable1').attr('style', 'width: '+($('#mainContent').width()-60)+'px !important');
	$( window ).bind("resize", function(){
		// Change the width of the div
		$('#divTable1').attr('style', 'width: '+($('#mainContent').width()-60)+'px !important');
	});
});
	</script>
</head>
<body id="page_bg">
<div id="skipwrapper">
    <a id="top" title="page top"></a>
    <a id="skiptocontent" href="#mainContentSkip" class="access">Skip Content</a>
</div>
<div id="wrap">
    <div id="header" class="headerArea">
        <div class="container">
            <div class="headerTool">
				<script type="text/javascript">createHeader();</script>
            </div>
        </div>
    </div>
    <div class="bodyArea">
        <div class="container">
            <div class="contentArea">
                <a id="mainContentSkip"></a>
                <div class="mainHeader"></div>
                <div class="breadcrumb"></div>
				<script type="text/javascript">pageTop();</script>
				<div id="mainContent" class="mainContent">
                <!--Begin Content-->
                <h1 class="no_h1">Tropical cyclone track information - GIS version</h1>
                <div class="border_blank">
                    <script src="/en/wxinfo/currwx/files/key.js"></script>
<script src="/en/wxinfo/currwx/files/scaleline.js"></script>
<link href="/en/wxinfo/currwx/files/scaleline.css" rel="stylesheet" />
<link href="/en/wxinfo/currwx/files/bootstrap.min.css" type="text/css" rel="stylesheet" />
<table id="table_header_icon" style="width: 100%;" class="self_row2_table">
    <tbody>
        <tr>
            <td>
                <table style="background-color: #f0d25a; width: 200px;" class="table_align_right td_valign_top table_border_0 table_cellpadding_2">
                    <tbody>
                        <tr>
                            <td style="background-color: #f0d25a;">
                                <a href="tc_fixarea.htm"><img src="/en/wxinfo/currwx/images/fixICON_tctrack.png" alt="Icon of Fixed-area map version" style="height: 45px; width: 60px; border: 0px;" /></a>
                            </td>
                            <td style="background-color: #f0d25a;">
                                <a href="tc_fixarea.htm" style="text-decoration: none;">Fixed-area map version</a>&nbsp;&nbsp;&nbsp;
                            </td>
                        </tr>
                    </tbody>
                </table>
            </td>
            <td>&nbsp;</td>
            <td>
                <table style="background-color: #87d156; width: 200px;" class="table_align_right td_valign_top table_border_0 table_cellpadding_2">
                    <tbody>
                        <tr>
                            <td style="background-color: #87d156;">
                                <a href="/en/probfcst/tc_spm.htm">
                                    <img src="/en/wxinfo/currwx/images/spmICON_tctrack.png" alt="Icon of Track Probability Forecast" style="height: 45px; width: 45px; border: 0px;" />
                                </a>
                            </td>
                            <td style="background-color: #87d156;">
                                <a href="/en/probfcst/tc_spm.htm" style="text-decoration: none;">Track Probability <br />Forecast</a>&nbsp;&nbsp;&nbsp;
                            </td>
                        </tr>
                    </tbody>
                </table>
            </td>
            <td>&nbsp;</td>
        </tr>
    </tbody>
</table>
<br />
<a id="main"></a>
<div style="text-align: center;">
    <h1>Tropical cyclone track information - GIS version</h1>
</div>
<table class="row2_table table_border_0 table_cellpadding_0 table_cellspacing_0" style="max-width: 800px; width: 100%; margin-left: auto; margin-right: auto;" id="div_tc">
    <tbody>
        <tr style="height: 30px;">
            <td style="text-align: center;" colspan="4">
                <strong>Tropical Cyclone: &nbsp;&nbsp;</strong>
                <span id="tc_selection"> <!-- Select active TC --> </span>
            </td>
        </tr>
        <tr style="height: 10px;">
            <td style="text-align: center;" colspan="4"></td>
        </tr>
        <tr>
            <td style="width: 25%;" class="self_align_center">
                <div class="btn-group">
                    <button type="button" id="cone_btn" class="btn" style="width: 165px; padding-left: 0px; padding-right: 0px;">
                        <span class="icon-ok"></span>&nbsp;Potential Track Area&nbsp;&nbsp;&nbsp;&nbsp;
                    </button>
                </div>
                <br />
                <div id="cone_info" style="visibility: show; font-size: 11px;">&nbsp;</div>
                &nbsp;
            </td>
            <td style="width: 25%;" class="self_align_center">
                <div class="btn-group">
                    <button type="button" id="text_btn" class="btn" style="width: 165px; padding-left: 0px; padding-right: 0px;">
                        <span class="icon-empty"></span>&nbsp;Forecast Time Label&nbsp;&nbsp;&nbsp;&nbsp;
                    </button>
                </div>
                <br />
                <div id="text_info" style="visibility: hidden; display: inline-block; font-size: 11px;">&nbsp;</div>
                &nbsp;
            </td>
            <td style="width: 25%;" class="self_align_center">
                <div class="btn-group">
                    <button type="button" id="sat_btn" class="btn" style="width: 165px; padding-left: 0px; padding-right: 0px;">
                        <span class="icon-empty"></span>&nbsp;Satellite Image&nbsp;&nbsp;&nbsp;&nbsp;
                    </button>
                </div>
                <br />
                <div id="sat_info" style="visibility: hidden; display: inline-block; font-size: 11px;">&nbsp;</div>
                &nbsp;
            </td>
            <td style="width: 25%;" class="self_align_center">
                <div class="btn-group">
                    <button type="button" id="rad_btn" class="btn" style="width: 165px; padding-left: 0px; padding-right: 0px;">
                        <span class="icon-empty"></span>&nbsp;Radar Image&nbsp;&nbsp;&nbsp;&nbsp;
                    </button>
                </div>
                <br />
                <div id="rad_info" style="visibility: hidden; display: inline-block; font-size: 11px;">&nbsp;</div>&nbsp;
            </td>
        </tr>
    </tbody>
</table>
<table style="display: none;">
    <tbody>
        <tr>
            <td>&nbsp;</td>
            <td style="vertical-align: top;"></td>
            <td style="vertical-align: top;">
                <div>
                    <input type="checkbox" id="cone_check" title="cone_check" onclick="ToggleLayer('cone');" checked="checked" style="display: show;" />
                </div>
            </td>
            <td style="vertical-align: top;">
                <div>
                    <input type="checkbox" id="text_check" title="text_check" onclick="ToggleLayer('text');" style="display: show;" />
                </div>
            </td>
            <td style="vertical-align: top;">
                <div>
                    <input type="checkbox" id="sat_check" title="sat_check" onclick="ToggleLayer('sat');" style="display: show;" />
                </div>
            </td>
            <td style="vertical-align: top;">
                <div>
                    <input type="checkbox" id="rad_check" title="rad_check" onclick="ToggleLayer('rad');" style="display: show;" />
                </div>
            </td>
            <td style="vertical-align: top;">
                <div style="display: none;"><input type="checkbox" id="dummy1_check" title="dummy1_check" onclick="ToggleMarker('dummy1');" style="display: show;" /></div>
                <div style="display: none;"><input type="checkbox" id="dummy2_check" title="dummy2_check" onclick="ToggleMarker('dummy2');" style="display: show;" /></div>
                <div style="display: none;"><input type="checkbox" id="dummy3_check" title="dummy3_check" onclick="ToggleMarker('dummy3');" style="display: show;" /></div>
                <span id="wind_info_div"><label id="wind_info" style="visibility: show; font-size: 9px; -webkit-text-size-adjust: none;">&nbsp;</label></span>
            </td>
        </tr>
    </tbody>
</table>
<!--table style="width:706px;" border=0 cellpadding=0 cellspacing=0>  
    <tr style="height:470px;">
        <td style="width:50px;">&nbsp;</td>
        <td style="width:656px;" colspan=2 align=left valign=center>
          <div id="map" style="width: 650px; height: 500px"></div>
        </td>
    </tr>
    </table-->
<div style="margin: 0; position: relative;" class="self_align_center">
    <div id="map" style="width: 100%; height: 500px;"></div>
</div>
<p style="height: 4px;"></p>
<table style="max-width: 706px; margin-left: auto; margin-right: auto;" class="table_border_0 table_cellpadding_0 table_cellspacing_0">
    <tbody>
        <tr>
            <td>
                <div id="display_info"><!-- Display TC Information --></div>
            </td>
        </tr>
    </tbody>
</table>
<p style="height: 5px;"></p>
<table style="max-width: 706px; margin-left: auto; margin-right: auto;" class="table_border_0 table_cellpadding_0 table_cellspacing_2 self_row2_table">
    <tbody>
        <tr>
            <td style="width: 7%;">&nbsp;</td>
            <td style="width: 30%; vertical-align: top;">
                <span style="font-weight: bold; text-decoration: underline;">Legend</span>
                <table style="width: 100%; font-size: 90%;">
                    <tbody>
                        <tr>
                            <td><img src="/en/wxinfo/currwx/images/past_position.png" alt="Analysed position icon" style="max-height: 26px; border: 0px; max-width: 50px;" /></td>
                            <td>Analysed Position</td>
                        </tr>
                        <tr>
                            <td><img src="/en/wxinfo/currwx/images/forecast_position.png" alt="Forecast position icon" style="max-height: 26px; border: 0px; max-width: 50px;" /></td>
                            <td>Forecast Position</td>
                        </tr>
                        <tr>
                            <td><img src="/en/wxinfo/currwx/images/past_track.png" alt="Past track icon" style="max-height: 26px; border: 0px; max-width: 50px;" /></td>
                            <td>Past Track</td>
                        </tr>
                        <tr>
                            <td><img src="/en/wxinfo/currwx/images/forecast_track.png" alt="Forecast track icon" style="max-height: 26px; border: 0px; max-width: 50px;" /></td>
                            <td>Forecast Track</td>
                        </tr>
                        <tr>
                            <td colspan="2"><em>(The color of the symbols above will change with the classification of the tropical cyclone)</em></td>
                        </tr>
                        <tr>
                            <td style="text-align: center;"><img src="/en/wxinfo/currwx/images/LOW.png" alt="Low pressure area or extratropical Low icon" style="max-height: 26px; border: 0px; max-width: 50px;" /></td>
                            <td>Low Pressure Area or Extratropical Low</td>
                        </tr>
                    </tbody>
                </table>
            </td>
            <td style="width: 1%;">&nbsp;</td>
            <td style="width: 30%; vertical-align: top;"><span style="font-weight: bold; text-decoration: underline;">Color</span>
                <table style="width: 100%; font-size: 90%;">
                    <tbody>
                        <tr>
                            <td style="text-align: center; width: 120px;"><img src="/en/wxinfo/currwx/images/trackpos_td.png" alt="Tropical depression icon" style="max-height: 26px; border: 0px;" /></td>
                            <td>Tropical Depression</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; width: 120px;"><img src="/en/wxinfo/currwx/images/trackpos_ts.png" alt="Tropical storm icon" style="max-height: 26px; border: 0px;" /></td>
                            <td>Tropical Storm</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; width: 120px;"><img src="/en/wxinfo/currwx/images/trackpos_sts.png" alt="Tropical depression icon" style="max-height: 26px; border: 0px;" /></td>
                            <td>Severe Tropical Storm</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; width: 120px;"><img src="/en/wxinfo/currwx/images/trackpos_t.png" alt="Typhoon icon" style="max-height: 26px; border: 0px;" /></td>
                            <td>Typhoon</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; width: 120px;"><img src="/en/wxinfo/currwx/images/trackpos_st.png" alt="Sever typhoon icon" style="max-height: 26px; border: 0px;" /></td>
                            <td>Severe Typhoon</td>
                        </tr>
                        <tr>
                            <td style="text-align: center;"><img src="/en/wxinfo/currwx/images/trackpos_supert.png" alt="Super typhoon icon" style="max-height: 26px; border: 0px;" /></td>
                            <td>Super Typhoon</td>
                        </tr>
                    </tbody>
                </table>
            </td>
            <td style="width: 1%;">&nbsp;</td>
            <td style="width: 31%; vertical-align: top;">
                <span style="font-weight: bold; text-decoration: underline;">Potential Track Area (70% probability)</span>
                <table style="width: 100%; font-size: 90%;">
                    <tbody>
                        <tr>
                            <td style="text-align: center; width: 120px;"><img src="/en/wxinfo/currwx/images/cone.png" alt="Track Uncertainty icon" style="opacity: 1.0; filter: alpha(opacity=100); border: 0px;" /></td>
                            <td>First 72 hours</td>
                        </tr>
                        <tr>
                            <td style="text-align: center; width: 120px;"><img src="/en/wxinfo/currwx/images/cone2.png" alt="Track Uncertainty icon" style="opacity: 0.8; filter: alpha(opacity=80); border: 0px;" /></td>
                            <td>72-120 hours</td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>
    </tbody>
</table>
<br /><br /><br />
<table style="width: 100%;" class="table_border_0 table_cellpadding_0 table_cellspacing_0" id="note_table">
    <tbody>
        <tr>
            <td id="note" headers="note_table" colspan="2" style="text-align: left;"><span style="text-decoration: underline; font-weight: bold;">Notes</span><br /><br /></td>
        </tr>
        <tr>
            <td id="note_content" headers="note_table" style="text-align: justify;">
                <ol>
                    <li>Tropical cyclones centred within the area bounded by 7-36N and 100-140E <span style="white-space: nowrap;">(<input type="checkbox" id="boundary_check" title="boundary_check" onclick="ToggleLayer('boundary');window.location.assign('#main');" style="position: relative; top: 1px; margin: 0px 1px 0px 3px; padding: 0;" />show on map)</span> will be shown on this website. According to the analysed position of the tropical cyclone and the tropical cyclone warning signal in force, the update time of this webpage will be different. Details are listed in the table below:<br /><br />
                        <div class="div_responsive_table_1" id="divTable1">
                            <table title="Table showing update time and information shown on the website" style="text-align: center; font-size: 95%; width: 95%;" class="data_table table_border_1" id="update_detail_table">
                                <tbody>
                                    <tr style="font-weight: bold;">
                                        <th id="sit_1" rowspan="2"></th>
                                        <th id="sit_2" rowspan="2">Tropical Cyclone<br />Warning Signal<br />No.1 or above<br />in force</th>
                                        <th id="sit_3" colspan="2">No Tropical Cyclone Warning Signal in force</th>
                                    </tr>
                                    <tr style="font-weight: bold;">
                                        <th id="sit_3_1" headers="sit_3" style="text-align: left; vertical-align: top;">Tropical cyclones<br />centred within the<br />area bounded by 10N<br />and 30N, 105E and 125E.*</th>
                                        <th id="sit_3_2" headers="sit_3" style="text-align: left;">Other tropical cyclones<br />centred within the<br />area bounded by 7N<br />and 36N,100E and<br />140E.</th>
                                    </tr>
                                    <tr rowspan="2">
                                        <td id="tc_updatetime" headers="sit_1" style="text-align: left;"><span style="color: #d70000; font-weight: bold;">Update time</span><br />[<span style="color: #0b6121; font-weight: bold;">Observation time</span>]<br /><small style="font-weight: bold;">(Hong Kong time)</small></td>
                                        <td id="tc_updatetime1" headers="sit_2" style="text-align: left;"><span style="color: #d70000;">Every hour<br /></span> [<span style="color: #0b6121;">Every hour</span>]</td>
                                        <td id="tc_updatetime2" headers="sit_3 sit_3_1" style="font-size: 95%;">&nbsp;<span style="color: #d70000;">00:30</span> [<span style="color: #0b6121;">23:00</span>]&nbsp;<br />&nbsp;<span style="color: #d70000;">03:30</span> [<span style="color: #0b6121;">02:00</span>]&nbsp;<br />&nbsp;<span style="color: #d70000;">06:30</span> [<span style="color: #0b6121;">05:00</span>]&nbsp;<br />&nbsp;<span style="color: #d70000;">09:30</span> [<span style="color: #0b6121;">08:00</span>]&nbsp;<br />&nbsp;<span style="color: #d70000;">12:30</span> [<span style="color: #0b6121;">11:00</span>]&nbsp;<br />&nbsp;<span style="color: #d70000;">15:30</span> [<span style="color: #0b6121;">14:00</span>]&nbsp;<br />&nbsp;<span style="color: #d70000;">18:30</span> [<span style="color: #0b6121;">17:00</span>]&nbsp;<br />&nbsp;<span style="color: #d70000;">21:30</span> [<span style="color: #0b6121;">20:00</span>]&nbsp;</td>
                                        <td id="tc_updatetime3" headers="sit_3 sit_3_2"><span style="color: #d70000;">04:00</span> [<span style="color: #0b6121;">02:00</span>]<br /><span style="color: #d70000;">10:00</span> [<span style="color: #0b6121;">08:00</span>]<br /><span style="color: #d70000;">16:00</span> [<span style="color: #0b6121;">14:00</span>]<br /><span style="color: #d70000;">22:00</span> [<span style="color: #0b6121;">20:00</span>]</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <span>*The tropical cyclone track, analysed positions and maximum sustained wind near centre are based on Hong Kong Observatory's <a href="/en/wxinfo/currwx/tcswarn.htm">tropical cyclone warning for shipping</a>.</span><br /><br />
                    </li>
                    <li>Detailed information of the tropical cyclone, including <span style="color: #d70000;">latitude</span>, <span style="color: #d70000;">longitude</span>, <span style="color: #d70000;">classification </span>and<span style="color: #d70000;"> the maximum sustained wind near centre</span> will be shown when placing the mouse cursor over the analysed or forecast positions. The user can use the controls on the left of the map to change the area of interest and to zoom into city or even street levels. Please bear in mind the uncertainty of the tropical cyclone locations as described below in using this function.<br /><br /></li>
                    <li><a id="note3"></a>While the forecast positions and track indicate the most likely future path of the tropical cyclone, they may deviate from the actual path of the storm. By pressing the <span style="color: #d70000;">'Potential Track Area'</span> button, the probable area within which the tropical cyclone will fall with a probability of 70% will be shown. Literally, it means that among 10 times of track forecast for similar situations, the tropical cyclone will be centred within the indicated area in about 7 times. The area grows as the forecast hour increases. It will be particularly larger beyond 72 hours and is indicated with lighter shadings on the map. The size in terms of radius of the 'Potential Track Area' corresponding to different forecast hours are determined from the error statistics of the forecasts issued in past years (updated in 2022) and are as shown in the following table:<br /><br />
                        <div class="div_responsive_table_1">
                            <table border="1" title="Table showing the uncertainty of the forecast track" style="width: 80%; max-width: 400px;" class="data_table">
                                <thead>
                                    <tr>
                                        <th id="pos" style="width: 210px;">Tropical Cyclone Track</th>
                                        <th id="radius">Radius of 'Potential Track Area'</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td id="pos1" headers="pos">Analysed position*</td>
                                        <td id="radius1" headers="radius">15 km</td>
                                    </tr>
                                    <tr>
                                        <td id="pos2" headers="pos">24-hour forecast position</td>
                                        <td id="radius2" headers="radius">100 km</td>
                                    </tr>
                                    <tr>
                                        <td id="pos3" headers="pos">48-hour forecast position</td>
                                        <td id="radius3" headers="radius">170 km</td>
                                    </tr>
                                    <tr>
                                        <td id="pos4" headers="pos">72-hour forecast position</td>
                                        <td id="radius4" headers="radius">255 km</td>
                                    </tr>
                                    <tr>
                                        <td id="pos5" headers="pos">96-hour forecast position</td>
                                        <td id="radius5" headers="radius">345 km</td>
                                    </tr>
                                    <tr>
                                        <td id="pos6" headers="pos">120-hour forecast position</td>
                                        <td id="radius6" headers="radius">465 km</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <span>*Analysed position refers to the positions of tropical cyclones fixed by the Observatory based on observation data available in real time. Such real-time positions could deviate from those obtained later through "Best Track Analysis" when more comprehensive sets of observations become available. The corresponding radius of 'Potential Track Area' is determined from the statistics in the past years as the mean value.</span><br /><br />
                    </li>
                    <li>Short-term erratic departure of the tropical cyclone from the general direction of movement may occur from time to time. These departures are partly due to uncertainties in locating the centre of the tropical cyclone, and partly due to actual short-term variations in the direction and speed of movement of the tropical cyclone itself.<br /><br /></li>
                    <li>The infra-red satellite image closest to the time of tropical cyclone analysed position can be shown by pressing the <span style="color: #d70000;">'Satellite Image'</span> button, below which is the 'Time of image' representing the time when satellite data is completely received at the ground reception system. Since it takes time to receive and process the satellite data as well as generate the image, the time of image may somtimes be different from the time of tropical cyclone analysed position.<br /><br /></li>
                    <li>The Hong Kong Observatory's radar images closest to the time of tropical cyclone analysed position can be shown by pressing the <span style="color: #d70000;">'Radar Image'</span> button, below which is the 'Time of image' representing the time when radar completes its scan. For detailed information, please refer to the <a href="/en/wxinfo/radars/radar.htm">Weather Radar Image</a> website.<br /><br /><!--<li>Dummydummy can be shown by pressing <a href="/education/edu01met/wxobs/ele_windc.htm#q4" target="_blank">'Dummy1'</a>,<a href="/education/edu01met/wxobs/ele_windc.htm#q4" target="_blank">'Dummy2'</a> or <a href="/education/edu01met/wxobs/ele_windc.htm#q4" target="_blank">'Dummy3'</a> buttton.<br/><br/>--></li>
                    <li>
                        <div>
                            <div><span>The background geographical information in this page comes from OpenStreetMap. The use of OpenStreetMap is to aid users in appreciating the geographical location of the areas affected by tropical cyclones. This does not imply that information on the map is endorsed by the Hong Kong Observatory. The use of OpenStreetMap is subject to its&nbsp;</span><a href="https://www.openstreetmap.org/copyright/en">License Terms</a>.<br /><br /></div>
                        </div>
                    </li>
                    <li>The satellite images were originally captured by the Himawari-9 (H9) satellite of Japan Meteorological Agency (JMA). Anyone wishing to further disseminate these satellite images should seek permission from JMA. (Address: Japan Meteorological Agency, 3-6-9 Toranomon, Minato City, Tokyo 105-8431, Japan). <!-- <li>This page is best viewed by Microsoft Internet Explorer 7, Firefox 4, Safari 4 or above.<br/><br/> --></li>
                </ol>
            </td>
        </tr>
        <tr>
            <td id="note_remark" headers="note_table">If you have any comments on our website, please fill in the <a href="https://eforms.weather.gov.hk/eforms_v2/sugg.fm">suggestion form</a> or send us an <a href="mailto:mailbox@hko.gov.hk">e-mail</a>.</td>
        </tr>
    </tbody>
</table>
<script>
    //===========================================================================
    // functions - General
    //===========================================================================

    function go2page(selObj) {
        //if(selObj.options[selObj.selectedIndex].value.search(default_value) == -1) {
        //alert(selObj.options[selObj.selectedIndex].value);
        if (selObj.options[selObj.selectedIndex].value != default_value) {
            default_value = selObj.options[selObj.options.selectedIndex].value;
            //changeTC(selObj.options[selObj.options.selectedIndex].value);
            changeTC(selObj.options.selectedIndex);
        }

        insert_tcid_2_href();
    }


    function insert_tcid_2_href() {
        if ($('select[name=TDID]').val() == 0) {
            $('.change_tc_id').attr('href', 'tc_fixarea.htm');
        } else {
            $('.change_tc_id').each(function () {
                $(this).attr('href', updateURLParameter($(this).attr('href'), 'tcid', $('select[name=TDID]').val()));
            });
        }
    }


    function handleEnter(selObj, e) {
        var charCode;
        if (e && e.which) {
            charCode = e.which;
        } else if (window.event) {
            e = window.event;
            charCode = e.keyCode;
        }
        if (charCode == 13) {
            //if(selObj.options[selObj.selectedIndex].value.search(default_value) == -1) {
            if (selObj.options[selObj.selectedIndex].value != default_value) {
                default_value = selObj.options[selObj.options.selectedIndex].value;
                //changeTC(selObj.options[selObj.options.selectedIndex].value);
                changeTC(selObj.options.selectedIndex);
            }
        }
    }


    //Read Data in txt
    var objRequesttxt;

    function DownloadUrl(url, callback) {

        var status = -1;
        var objRequesttxt = RequestObject();

        if (!objRequesttxt) {
            return false;
        }



        objRequesttxt.onreadystatechange = function () {
            if (objRequesttxt.readyState == 4) {
                try {
                    status = objRequesttxt.status;
                } catch (e) {
                    // Usually indicates request timed out in FF.
                }
                if (status == 200) {
                    //callback(request.responseXML, request.status);
                    callback(objRequesttxt.responseText, objRequesttxt.status);
                    objRequesttxt.onreadystatechange = function () { };
                }
            }
        }

        objRequesttxt.open('GET', url, true);

        try {
            objRequesttxt.send(null);
        } catch (e) {
            //changeStatus(e);
        }

    };


    function RequestObject() {
        if (window.XMLHttpRequest && !(window.ActiveXObject)) {
            //For Firefox, Chrome, Safari and Opera
            request = new XMLHttpRequest();
        } else if (window.ActiveXObject) {
            try {
                //For IE 9 or above, IE 7
                request = new ActiveXObject("Msxml2.XMLHTTP");
            } catch (e) {
                //For IE 8 or below
                //alert(e.toString());
                //alert("Request Object Error!");
                request = new ActiveXObject("Microsoft.XMLHTTP");
            }
        }
        return request;
    }


    //--- Read Position Data -------------------------------------------------------
    read_data = function (doc) {
        // === split the document into lines ===
        lines = doc.split("\n");
        var last_lat = null;
        var last_lon = null;
        var last_color = "#000000";
        var tmp_color = "";
        var num_forecast = 0;
        var start_draw = false;
        var current_tc_id = "";
        var current_tc_name = "";
        label_count = 0;

        for (var i = 0; i < lines.length; i++) {
            if (i == 0) {
                data_content = lines[i].split("=");
                current_tcid = data_content[0];
                for (var x = 0; x < TC_Count; x++) {
                    if (parseInt(TC_ID[x]) == parseInt(current_tcid)) {
                        current_tc_name = ENG[x];
                    }
                }
            } else if (lines[i].length > 1) {
                data_content = "";
                data_content = lines[i].split(",");

                if (data_content.length == 14 || data_content.length == 17 || data_content.length == 29) {
                    //------------------------------------------------------------------------------------------
                    //   0        1          2       3     4      5     6     7        8         9        10     11 12  13       14                 15           16
                    //[index],[centre],[intensity],[UTC],[HKT],[FChr],[lat],[long],[max wind],[speed],[movement],  ,   ,  , [moving speed],[moving direction],[moving direction opt]

                    //   17             18        19          20        21         22        23       24          25                26             27            28
                    //[dummy1_ne],[dummy1_se],[dummy1_sw],[dummy1_nw],[dummy2_ne],[strom_se],[strom_sw],[dummy1_nw],[dummy3_ne],[dummy3_se],[dummy3_sw],[dummy3_nw]  
                    /*
                    where
                    index - P = past, A = Actual, F = Forecast
                    centre - HKOO, HKOL
                    intensity - TL, LOW, TD, TS, STS, T, ST, SUPERT
                    UTC - warn time in UTC
                    HKT - warn time in HKT
                    FChr - forecast hour, 0 = past or actural
                    */
                    //------------------------------------------------------------------------------------------


                    var display_time = 0;
                    var intensity_color = "#FFFFFF";

                    if (data_content[2] == "TD") intensity_color = "#000000";
                    else if (data_content[2] == "TS") intensity_color = "#009900";
                    else if (data_content[2] == "STS") intensity_color = "#0000ff";
                    else if (data_content[2] == "T") intensity_color = "#ff0000";
                    else if (data_content[2] == "ST") intensity_color = "#ff96c8";
                    else if (data_content[2] == "SUPERT") intensity_color = "#8c1e78";

                    if (data_content[2] == "TL" || data_content[8] == "999") {
                        data_content[8] = "-";
                    }

                    display_time = -1;
                    var date_display = "";
                    var date_display_map = "";
                    var tc_name = "";

                    var str = data_content[4];
                    var yyyy = str.substr(0, 4);
                    var mm = str.substr(4, 2);
                    var dd = str.substr(6, 2);
                    var hh = str.substr(8, 2);


                    if (mm == "01") mm = "Jan";
                    else if (mm == "02") mm = "Feb";
                    else if (mm == "03") mm = "Mar";
                    else if (mm == "04") mm = "Apr";
                    else if (mm == "05") mm = "May";
                    else if (mm == "06") mm = "Jun";
                    else if (mm == "07") mm = "Jul";
                    else if (mm == "08") mm = "Aug";
                    else if (mm == "09") mm = "Sep";
                    else if (mm == "10") mm = "Oct";
                    else if (mm == "11") mm = "Nov";
                    else if (mm == "12") mm = "Dec";
                    else mm = "--";

                    //remove leading zero
                    //mm = parseFloat(mm).toFixed(0);
                    dd = parseFloat(dd).toFixed(0);
                    date_display = +dd + " " + mm + ", " + hh + "HKT";


                    if ((data_content[0] == 'A' || data_content[0] == 'F') && data_content[2] != "-99") {
                        /*
                        if (data_content[0]=='A'){
                            date_display_map =date_display;
                        }else{
                            date_display_map =date_display;
                        }
                        */

                        date_display_map = date_display;
                        //   0        1          2       3     4      5     6     7        8         9        10
                        //[index],[centre],[intensity],[UTC],[HKT],[FChr],[lat],[long],[max wind],[speed],[movement]

                        display_time = lines.length - i;

                        if (data_content[0] == 'A') {
                            Analyzed_date = data_content[4];
                            Analyzed_time = data_content[4];
                            var full_intensity = "";
                            if (data_content[2] == "TD") full_intensity = "Tropical Depression";
                            else if (data_content[2] == "TS") full_intensity = "Tropical Storm";
                            else if (data_content[2] == "STS") full_intensity = "Severe Tropical Storm";
                            else if (data_content[2] == "T") full_intensity = "Typhoon";
                            else if (data_content[2] == "ST") full_intensity = "Severe Typhoon";
                            else if (data_content[2] == "SUPERT") full_intensity = "Super Typhoon";
                            else if (data_content[2] == "TL") full_intensity = "Extratropical Low";
                            //else if (data_content[2] == "L")      full_intensity = "Low Pressure Area";
                            else if ((data_content[2] == "LOW") && (data_content[8] == "--")) {
                                full_intensity = "Extratropical Low";
                                // add case to filter (former L or former EL)
                                if (current_tc_name != "NO NAME" && current_tc_name != "Low Pressure Area" && current_tc_name != "Extratropical Low") {
                                    current_tc_name = "(Former " + current_tc_name + ")";
                                }
                            } else if (data_content[2] == "LOW" || data_content[2] == "L") {
                                full_intensity = "Low Pressure Area";
                                // add case to filter (former L or former EL)
                                if (current_tc_name != "NO NAME" && current_tc_name != "Low Pressure Area" && current_tc_name != "Extratropical Low") {
                                    current_tc_name = "(Former " + current_tc_name + ")";
                                }
                            }

                            Analyzed_class = full_intensity;
                            Analyzed_lat = Math.round(data_content[6] * 10.0) / 10.0 + "";
                            Analyzed_lon = Math.round(data_content[7] * 10.0) / 10.0 + "";

                            if (Analyzed_lat.indexOf(".") == -1) {
                                Analyzed_lat = Analyzed_lat + ".0";
                            }

                            if (Analyzed_lon.indexOf(".") == -1) {
                                Analyzed_lon = Analyzed_lon + ".0";
                            }

                            current_Lat = data_content[6];
                            current_Lon = data_content[7];
                            Analyzed_wind = data_content[8];

                            var ref_location = "";
                            if (data_content[11] == "0") ref_location = "of Hong Kong Observatory";
                            else if (data_content[11] == "1") ref_location = "of Hong Kong";

                            var distance = data_content[12];
                            var direction = data_content[13].split("\r", 1);

                            if (direction == "N") direction = "north";
                            else if (direction == "NNE") direction = "north-northeast";
                            else if (direction == "NE") direction = "northeast";
                            else if (direction == "ENE") direction = "east-northeast";
                            else if (direction == "E") direction = "east";
                            else if (direction == "ESE") direction = "east-southeast";
                            else if (direction == "SE") direction = "southeast";
                            else if (direction == "SSE") direction = "south-southeast";
                            else if (direction == "S") direction = "south";
                            else if (direction == "SSW") direction = "south-southwest";
                            else if (direction == "SW") direction = "southwest";
                            else if (direction == "WSW") direction = "west-southwest";
                            else if (direction == "W") direction = "west";
                            else if (direction == "WNW") direction = "west-northwest";
                            else if (direction == "NW") direction = "northwest";
                            else if (direction == "NNW") direction = "north-northwest";

                            var mov_speed = -9999;
                            var mov_direct = -9999;
                            var mov_directopt = -9999;

                            //if (data_content.length==17) {
                            if (data_content.length >= 17) {
                                mov_speed = data_content[14];
                                mov_direct = data_content[15].split("\r", 1);
                                mov_directopt = data_content[16].split("\r", 1);
                            }

                            var mov_speeddirectField = '';

                            if (mov_speed != -9999) {
                                if (mov_direct != -9999) {
                                    if (mov_directopt != -9999) {
                                        mov_speeddirectField = "<tr>" +
                                            // "<td style=\"width:50px;\">&nbsp;</td>"+
                                            "<td colspan=2 style=\"width:656px;\"><strong>Forecast moving direction and speed:</strong>&nbsp;&nbsp;<span style=\"color:#D70000;\">" + en_LongName_16compass[mov_direct] + "</span> or <span style=\"color:#D70000;\">" + en_LongName_16compass[mov_directopt] + "</span>,&nbsp;<span style=\"color:#D70000;\">" + mov_speed + "</span> km/h</td></tr>";
                                    } else {
                                        mov_speeddirectField = "<tr>" +
                                            //"<td style=\"width:50px;\">&nbsp;</td>"+
                                            "<td colspan=2 style=\"width:656px;\"><strong>Forecast moving direction and speed:</strong>&nbsp;&nbsp;<span style=\"color:#D70000;\">" + en_LongName_16compass[mov_direct] + "</span>,&nbsp;<span style=\"color:#D70000;\">" + mov_speed + "</span> km/h</td></tr>";
                                    }
                                }
                            }

                            var nameField = '';

                            if ((Analyzed_class == current_tc_name) || (current_tc_name == "") || (current_tc_name == "NO NAME")) {
                                nameField = "<td colspan=2 style=\"width:656px;\"><strong>Name:</strong>&nbsp;&nbsp;<span style=\"color:#D70000;\">" + Analyzed_class + "</span></td>";
                            } else {
                                nameField = "<td colspan=2 style=\"width:656px;\"><strong>Name:</strong>&nbsp;&nbsp;<span style=\"color:#D70000;\">" + Analyzed_class + " " + current_tc_name + "</span></td>";
                            }

                            var directionField = '';

                            if ((distance != -9999) && (direction != -9999)) {
                                directionField = "&nbsp;(about <span style=\"color:#D70000;\">" + distance + "</span> km <span style=\"color:#D70000;\">" + direction + "</span>&nbsp;" + ref_location + ")";
                            }

                            if (Analyzed_wind == "--") {
                                Analyzed_wind = "<span style=\"color:#D70000;\">" + Analyzed_wind + "</span>";
                            } else {
                                Analyzed_wind = "<span style=\"color:#D70000;\">" + Analyzed_wind + "</span> km/h";
                            }

                            tc_info =
                                "<tr>" +
                                //"<td style=\"width:50px;\">&nbsp;</td>"+
                                nameField +
                                "</tr><tr>" +
                                //"<td style=\"width:50px;\">&nbsp;</td>"+
                                "<td style=\"width:400px;\"><strong>Date:</strong>&nbsp;&nbsp;<span style=\"color:#D70000;\">" + dd + " " + mm + " " + yyyy + "</span></td>" +
                                "<td style=\"width:256px;\"><strong>Time:</strong>&nbsp;&nbsp;<span style=\"color:#D70000;\">" + hh + "</span>&nbsp;HKT</td>" +
                                "</tr><tr>" +
                                //"<td style=\"width:50px;\">&nbsp;</td>"+
                                "<td colspan=2 style=\"width:656px;\"><strong>Position:</strong>&nbsp;&nbsp;<span style=\"color:#D70000;\">" + Analyzed_lat + "</span>&nbsp;N,&nbsp;<span style=\"color:#D70000;\">" + Analyzed_lon + "</span>&nbsp;E" + directionField + "</td>" +
                                //"&nbsp;(about <font color=red>"+distance+"</font> km <font color=red>"+direction+"</font>&nbsp;"+ref_location+")</td>"
                                "</tr><tr>" +
                                // "<td style=\"width:50px;\">&nbsp;</td>"+
                                "<td colspan=2 style=\"width:656px;\"><strong>Maximum sustained wind near centre:</strong>&nbsp;&nbsp;" + Analyzed_wind + "</td></tr>" +


                                mov_speeddirectField;


                            var current_tcid_temp = current_tcid.replace(/(\r\n|\n|\r)/gm, "");

                            document.getElementById('myinfo_' + current_tcid_temp).innerHTML =
                                "<table border=0 style=\"max-width:706px;\" cellpadding=0 cellspacing=0 align=left>" + tc_info + "</table>";
                            //avoid showing the description first
                            document.getElementById("mydesc_" + current_tcid_temp).style.visibility = "visible";
                            document.getElementById("myMovSpeedDirect_" + current_tcid_temp).style.visibility = "visible";
                            if (data_content[2] != "-99" && data_content[8] != "-99") {
                                if (data_content[2] != "LOW" && data_content[2] != "TL")
                                    tcLabel(current_tc_name, date_display, Analyzed_lat, Analyzed_lon);
                            }


                        } else if (num_forecast == 0) {
                            num_forecast++;
                            display_time = -9;
                        } else if (num_forecast == 1) {
                            num_forecast++;
                            display_time = -9;
                        } else if (num_forecast == 2) {
                            num_forecast++;
                            display_time = -9;
                        }


                        if (data_content[0] == 'A' && data_content[2] != "-99") {

                            Analyzed_lat = Math.round(data_content[6] * 10.0) / 10.0 + "";
                            Analyzed_lon = Math.round(data_content[7] * 10.0) / 10.0 + "";

                            if (Analyzed_lat.indexOf(".") == -1) {
                                Analyzed_lat = Analyzed_lat + ".0";
                            }
                            if (Analyzed_lon.indexOf(".") == -1) {
                                Analyzed_lon = Analyzed_lon + ".0";
                            }

                            tcLabel(false, "", Analyzed_lat, Analyzed_lon);

                        }

                        if (data_content[0] == 'F' && data_content[2] != "-99") {

                            Analyzed_lat = Math.round(data_content[6] * 10.0) / 10.0 + "";
                            Analyzed_lon = Math.round(data_content[7] * 10.0) / 10.0 + "";

                            if (Analyzed_lat.indexOf(".") == -1) {
                                Analyzed_lat = Analyzed_lat + ".0";
                            }
                            if (Analyzed_lon.indexOf(".") == -1) {
                                Analyzed_lon = Analyzed_lon + ".0";
                            }

                            tcLabel(false, date_display, Analyzed_lat, Analyzed_lon);
                        }
                    }
                }
            }
            textLayer.setVisibility(document.getElementById('text_check').checked);
        }

        //in case hk cannot be shown, zoom out one level
        if (current_Lat < 12 || current_Lat > 30 || current_Lon < 102.5 || current_Lon > 128) {
            map.zoomTo(4);
        } else {
            map.zoomTo(5);
        }

        map.setCenter(
            new OpenLayers.LonLat(current_Lon, current_Lat).transform(
                new OpenLayers.Projection("EPSG:4326"),
                map.getProjectionObject()
            )
        );

        allTcTextCheck++;

        if (allTc) {
            if (allTcTextCheck == TC_Count) {
                textLayer.removeAllFeatures();
                textLayer.addFeatures(this.tcText);
                nameLayer.removeAllFeatures();
                nameLayer.addFeatures(this.tcName);
            }
        } else {
            textLayer.removeAllFeatures();
            textLayer.addFeatures(this.tcText);
            nameLayer.removeAllFeatures();
            nameLayer.addFeatures(this.tcName);
        }

    }


    var en_LongName_16compass = {
        "N": "north",
        "NNE": "north-northeast",
        "NE": "northeast",
        "ENE": "east-northeast",
        "E": "east",
        "ESE": "east-southeast",
        "SE": "southeast",
        "SSE": "south-southeast",
        "S": "south",
        "SSW": "south-southwest",
        "SW": "southwest",
        "WSW": "west-southwest",
        "W": "west",
        "WNW": "west-northwest",
        "NW": "northwest",
        "NNW": "north-northwest"
    };


    //--- Read Description Data in xml-------------------------------------------
    var objRequestxml;

    function read_data_des(strXMLFile) {
        objRequestxml = RequestObject();
        objRequestxml.open("GET", strXMLFile, false);
        objRequestxml.onreadystatechange = getDesFromXML;
        objRequestxml.send(null);
    }

    function getDesFromXML() {

        if (objRequestxml.readyState == 4) {

            if (objRequestxml.status == 200) {

                var xmlDoc;
                var Des_text = "";
                var TCID_text = "";
                var MovSpeedDirect_text = "";


                try {
                    xmlDoc = objRequestxml.responseXML.documentElement;
                    TCID_text = xmlDoc.getElementsByTagName("TCID")[0].childNodes[0].nodeValue;
                } catch (e) { } //suppress error in case there is no xml/broken xml/null description

                try {
                    Des_text = xmlDoc.getElementsByTagName("Description")[0].childNodes[0].nodeValue;
                } catch (e) { } //suppress error in case there is no xml/broken xml/null description

                try {
                    MovSpeedDirect_text = xmlDoc.getElementsByTagName("Movement")[0].childNodes[0].nodeValue;
                } catch (e) { } //suppress error in case there is no xml/broken xml/null description



                var fieldName = "mydesc_" + TCID_text;

                if (Des_text != "") {

                    document.getElementById(fieldName).innerHTML = "<table border=0 style=\"max-width:706px;\" cellpadding=0 cellspacing=0 align=left>" +
                        "<tr>" +
                        // "<td style=\"width:50px;\">&nbsp;</td>"+
                        "<td colspan=2 style=\"width:656px;\"><BR>" + Des_text + "</td></tr>" +
                        "</table>";
                }

                fieldName = "myMovSpeedDirect_" + TCID_text;

                if (MovSpeedDirect_text != "") {
                    document.getElementById(fieldName).innerHTML = "<table border=0 style=\"max-width:706px;\" cellpadding=0 cellspacing=0 align=left>" +
                        "<tr>" +
                        // "<td style=\"width:50px;\">&nbsp;</td>"+
                        "<td colspan=2 style=\"width:656px;\"><strong>Forecast moving direction and speed:</strong>&nbsp;&nbsp;" + MovSpeedDirect_text + "</td></tr>" +
                        "</table>";
                }
            }
        }
    }

    function changeTC(selectedID) {
        tcTrack.removeAllFeatures();
        tcCone.removeAllFeatures();
        tcSat.removeAllFeatures();
        tcRad.removeAllFeatures();
        textLayer.removeAllFeatures();
        nameLayer.removeAllFeatures();

        var posinfoFile = "";
        var posinfoFile_des = "";
        var thisdate = new Date();

        this.allTcTextCheck = 0;
        this.tcText = [];
        this.tcName = [];
        this.allTc = false;


        if (selectedID == 0) {
            this.allTc = true;
            drawInfoTable(TC_ID, -1);
            for (var i = 0; i < TC_Count; i++) {
                loadkml(i);
                posinfoFile = '/wxinfo/currwx/tc_gis_posinfo_15a_' + TC_ID[i] + '.txt';
                posinfoFile_des = '/wxinfo/currwx/tc_des_e_' + TC_ID[i] + '.xml';
                DownloadUrl(posinfoFile, read_data);
                read_data_des(posinfoFile_des);
            }
        } else {
            this.allTc = false;
            loadkml(selectedID - 1);
            drawInfoTable(TC_ID, selectedID - 1);
            posinfoFile = '/wxinfo/currwx/tc_gis_posinfo_15a_' + TC_ID[selectedID - 1] + '.txt';
            posinfoFile_des = '/wxinfo/currwx/tc_des_e_' + TC_ID[selectedID - 1] + '.xml';
            DownloadUrl(posinfoFile, read_data);
            read_data_des(posinfoFile_des);
        }
    }


    function drawInfoTable(tc_list, selectedindex) {
        var info_table = "";
        var startindex = 0;
        var endindex = tc_list.length;
        if (selectedindex != -1) {
            startindex = selectedindex;
            endindex = selectedindex + 1;
        } else {
            startindex = 0;
            endindex = tc_list.length;
        }

        for (var i = startindex; i < endindex; i++) {
            info_table = info_table +
                "<table border=0 cellpadding=0 cellspacing=0>" +
                "<tr><td><div id=myinfo_" + tc_list[i] + "></div></td></tr>" +
                "<tr><td><div style=\"visibility:hidden\" id=myMovSpeedDirect_" + tc_list[i] + "></div></td></tr>" +
                "<tr><td><div style=\"visibility:hidden\" id=mydesc_" + tc_list[i] + "></div></td></tr>" +
                "<tr><td>&nbsp;</td></tr>" +
                "</td></tr></table>";
        }
        document.getElementById('display_info').innerHTML = info_table;
    }

    var hideBoundary = true;
    var hideCone = false;
    var showText = false;
    var showSat = false;
    var showRad = false;

    function resetSelection() {
        document.getElementById('boundary_check').checked = false;
        document.getElementById('cone_check').checked = true;
        document.getElementById('text_check').checked = false;
        document.getElementById('sat_check').checked = false;
        document.getElementById('rad_check').checked = false;
        applySetting();

    }

    function resetButton() {

        if (hideCone) {
            if (document.getElementById('cone_check').checked) {
                $('#cone_btn').click();
            }
        }

        if (showText) {
            if (!document.getElementById('text_check').checked) {
                $('#text_btn').click();
            }
        }

        if (showSat) {
            if (!document.getElementById('sat_check').checked) {
                $('#sat_btn').click();
            }
        }

        if (showRad) {
            if (!document.getElementById('rad_check').checked) {
                $('#rad_btn').click();
            }
        }

        if (hideBoundary) {
            if (document.getElementById('boundary_check').checked) {
                $('#boundary_btn').click();
            }
        }
    }

    function applySetting() {
        var satCook = getCookieTC("sat");
        var radCook = getCookieTC("rad");
        var coneCook = getCookieTC("cone");
        var boundaryCook = getCookieTC("boundary");
        var timeCook = getCookieTC("time");

        if (boundaryCook == "false") {
            hideBoundary = true;
        }

        if (coneCook == "false") {
            hideCone = true;
        }

        if (satCook == "true") {
            $('#sat_btn').click();
            showSat = true;
        }

        if (radCook == "true") {
            showRad = true;
        }

        if (timeCook == "true") {
            showText = true;
        }

    }

    function setcookie(c_name, c_value, exdays) {
        var exdate = new Date();
        exdate.setDate(exdate.getDate() + exdays);
        document.cookie = c_name + "=" + c_value + ";";
    }

    function getCookieTC(c_name) {
        var c_value = document.cookie;
        var c_start = c_value.indexOf(" " + c_name + "=");
        if (c_start == -1) {
            c_start = c_value.indexOf(c_name + "=");
        }
        if (c_start == -1) {
            c_value = null;
        } else {
            c_start = c_value.indexOf("=", c_start) + 1;
            var c_end = c_value.indexOf(";", c_start);
            if (c_end == -1) {
                c_end = c_value.length;
            }
            c_value = unescape(c_value.substring(c_start, c_end));
        }
        return c_value;
    }

    //===========================================================================
    // functions - GIS
    //=========================================================================== 

    //Draw 400KM Range Ring
    cir_circle_400 = function (doc) {
        // === split the document into lines ===  
        lines = doc.split("\n");
        var last_lat = null;
        var last_lon = null;
        var write = false;
        var count = 0;

        for (var i = 0; i < lines.length; i = i + 25) {
            if (lines[i].length > 1) {
                data_content = lines[i].split(",");
                if (data_content.length == 2) {
                    if (count >= 12)
                        count = 0;
                    else
                        count++;

                    if (count == 1 || count == 3 || count == 4 || count == 5 || count == 7 || count == 9 || count == 10 || count == 11) {
                        write = true;
                    } else {
                        write = false;
                    }

                    if (last_lat != null && last_lon != null && write) {
                        var point1 = new OpenLayers.Geometry.Point(parseFloat(data_content[1]), parseFloat(data_content[0]));
                        point1 = point1.transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject());
                        var point2 = new OpenLayers.Geometry.Point(last_lon, last_lat);
                        point2 = point2.transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject());

                        var points = new Array(point1, point2);
                        var line = new OpenLayers.Geometry.LineString(points);
                        var style = {
                            strokeColor: "#505050",
                            strokeWeight: 2
                        };
                        var lineFeature = new OpenLayers.Feature.Vector(line, null, style);
                        lineLayer.addFeatures([lineFeature]);
                    }
                    last_lat = parseFloat(data_content[0]);
                    last_lon = parseFloat(data_content[1]);
                }
            }
        }

        //-- Add 400KM Label ------------------
        var desc_400 = "400km";
        var point_400 = new OpenLayers.Geometry.Point(110.8, 20.2);
        point_400 = point_400.transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject());
        var tcText = new OpenLayers.Feature.Vector(point_400, null, {
            label: desc_400,
            labelXOffset: 0,
            labelYOffset: 0,
            labelAlign: "lb",
            fontSize: '8px',
            fontWeight: 'bold',
            fontStyle: 'italic'
        });
        lineLayer.addFeatures([tcText]);
    }

    //--- Function : Draw 800KM Range Ring------------------------------------------
    cir_circle_800 = function (doc) {
        // === split the document into lines ===
        lines = doc.split("\n");
        var last_lat = null;
        var last_lon = null;
        var write = false;
        var count = 1;

        for (var i = 1; i < lines.length; i = i + 20) {
            if (lines[i].length > 1) {
                data_content = lines[i].split(",");
                if (data_content.length == 2) {
                    if (count >= 12)
                        count = 1;
                    else
                        count++;

                    if (count == 1 || count == 3 || count == 4 || count == 5 || count == 7 || count == 9 || count == 10 || count == 11) {
                        write = true;
                    } else {
                        write = false;
                    }

                    if (last_lat != null && last_lon != null && write) {
                        var point1 = new OpenLayers.Geometry.Point(parseFloat(data_content[1]), parseFloat(data_content[0]));
                        point1 = point1.transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject());
                        var point2 = new OpenLayers.Geometry.Point(last_lon, last_lat);
                        point2 = point2.transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject());

                        var points = new Array(point1, point2);
                        var line = new OpenLayers.Geometry.LineString(points);
                        var style = {
                            strokeColor: "#505050",
                            strokeWeight: 2
                        };

                        var lineFeature = new OpenLayers.Feature.Vector(line, null, style);
                        lineLayer.addFeatures([lineFeature]);
                    }
                    last_lat = parseFloat(data_content[0]);
                    last_lon = parseFloat(data_content[1]);
                }
            }
        }

        //-- Add 800KM Label ------------------
        var desc_800 = "800km";
        var point_800 = new OpenLayers.Geometry.Point(106.7, 19.7);
        point_800 = point_800.transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject());
        var tcText = new OpenLayers.Feature.Vector(point_800, null, {
            label: desc_800,
            labelXOffset: 0,
            labelYOffset: 0,
            labelAlign: "lb",
            fontSize: '8px',
            fontWeight: 'bold',
            fontStyle: 'italic'
        });
        lineLayer.addFeatures([tcText]);
    }

    function ToggleLayer(ItemId) {
        var checked = false;
        if (ItemId == "boundary") {
            checked = $('input[type=checkbox][id="boundary_check"]').is(":checked");
        } else {
            var icon = $('#' + ItemId + '_btn').find('[class^="icon-"]');
            checked = !icon.hasClass('icon-ok');
            icon.toggleClass('icon-blank', !checked).toggleClass('icon-ok', checked);

            if (checked)
                document.getElementById(ItemId + '_info').style.visibility = 'visible';
            else
                document.getElementById(ItemId + '_info').style.visibility = 'hidden';
        }

        document.getElementById(ItemId + '_check').checked = checked;
        var myLayer;
        switch (ItemId) {
            case 'cone':
                myLayer = tcCone;
                break;
            case 'sat':
                myLayer = tcSat;
                break;
            case 'rad':
                myLayer = tcRad;
                break;
            case 'boundary':
                myLayer = tcBoundary;
                break;
            case 'text':
                myLayer = textLayer;
                break;
        }
        myLayer.setVisibility(checked);
    }

    function loadkml(i) {
        var kmlfile = "/wxinfo/currwx/tc_gis_track_15a_e_" + TC_ID[i] + ".xml";
        $.get(kmlfile, function (content) {
            // Parse KML data and add data to map
            var kmlParser = new OpenLayers.Format.KML2({
                internalProjection: map.getProjectionObject(),
                extractStyles: true,
                extractAttributes: true
            });
            var features = kmlParser.read(content);
            tcTrack.addFeatures(features);
        });
        tcTrack.setVisibility(true);

        document.getElementById('cone_info').innerHTML = "(Not applicable)";
        var kmlfilecone = "/wxinfo/currwx/tc_gis_cone_15a_" + TC_ID[i] + ".kml";
        $.get(kmlfilecone, function (content) {
            // Parse KML data and add data to map
            var kmlParser = new OpenLayers.Format.KML({
                internalProjection: map.getProjectionObject(),
                extractStyles: true,
                extractAttributes: true
            });

            var features = kmlParser.read(content);
            if (features.length > 0) {
                tcCone.addFeatures(features);
                document.getElementById('cone_info').innerHTML = "";
            } else {
                document.getElementById('cone_info').innerHTML = "(Not applicable)";
            }
        });
        tcCone.setVisibility(document.getElementById('cone_check').checked);

        var kmlfile = "/wxinfo/currwx/tc_gis_sat_" + TC_ID[i] + ".kml";
        document.getElementById('sat_info').innerHTML = "(Not applicable)";
        $.get(kmlfile, function (content) {
            // Parse KML data and add data to map
            var xmlstr = content.xml ? content.xml : (new XMLSerializer()).serializeToString(content);
            xmlstr = xmlstr.replace(/<href>.\//g, "<href>/wxinfo/currwx/");
            var kmlParser = new OpenLayers.Format.KML2({
                internalProjection: map.getProjectionObject(),
                extractStyles: true,
                extractAttributes: true
            });

            var features = kmlParser.read(xmlstr);
            tcSat.addFeatures(features);
            for (var feat in features) {
                for (var tag in features[feat].attributes) {
                    if (tag == "description") {
                        if (features[feat].attributes[tag] != "error") {
                            document.getElementById('sat_info').innerHTML = "Image time:" + features[feat].attributes[tag];
                        } else {
                            document.getElementById('sat_info').innerHTML = "(Not applicable)";
                        }
                        break;
                    }
                }
            }
        });

        tcSat.setVisibility(document.getElementById('sat_check').checked);

        var kmlfile = "/wxinfo/currwx/tc_gis_rad_" + TC_ID[i] + ".kml";

        document.getElementById('rad_info').innerHTML = "(Not applicable)";
        $.get(kmlfile, function (content) {
            // Parse KML data and add data to map
            var xmlstr = content.xml ? content.xml : (new XMLSerializer()).serializeToString(content);
            xmlstr = xmlstr.replace(/<href>.\//g, "<href>/wxinfo/currwx/");
            var kmlParser = new OpenLayers.Format.KML2({
                internalProjection: map.getProjectionObject(),
                extractStyles: true,
                extractAttributes: true
            });
            var features = kmlParser.read(xmlstr);
            tcRad.addFeatures(features);
            for (var feat in features) {
                for (var tag in features[feat].attributes) {
                    if (tag == "description") {
                        if (features[feat].attributes[tag] != "error") {
                            document.getElementById('rad_info').innerHTML = "Image time:" + features[feat].attributes[tag];
                        } else {
                            document.getElementById('rad_info').innerHTML = "(Not applicable)";
                        }
                        break;
                    }
                }
            }
        });
        tcRad.setVisibility(document.getElementById('rad_check').checked);
        tcBoundary.setVisibility(document.getElementById('boundary_check').checked);
    }

    function createpopup(feature) {
        var centroid = feature.geometry.getCentroid();
        map.popup = new OpenLayers.Popup.FramedCloud(feature.id,
            new OpenLayers.LonLat(centroid.x, centroid.y),
            new OpenLayers.Size(320, 125),
            feature.attributes.description,
            null,
            true);
        if (feature.attributes.description != null) {
            map.popup.autoSize = true;
        }

        map.popup.panMapIfOutOfView = true;
        feature.popup = map.popup;
        map.addPopup(map.popup);
    }

    function clearpopup() {
        if (map.popup) {
            map.removePopup(map.popup);
            map.popup.destroy();
            map.popup = null;
        }
    }

    function tcLabel(tc_name, hkt_map, lat, lon) {
        var point = new OpenLayers.Geometry.Point(lon, lat);
        point = point.transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject());

        var desc = "";
        if (tc_name == "undefined" || !tc_name) {
            desc = hkt_map;
            var tcText = new OpenLayers.Feature.Vector(point, null, {
                label: desc,
                labelXOffset: 7,
                labelYOffset: 6,
                labelAlign: "lb",
                fontFamily: 'Arial'
            });
            //var tcText = new OpenLayers.Feature.Vector(point, null, {label: desc, labelXOffset: 7, labelYOffset: 6, labelAlign: "lb", fontWeight: 'bold', fontFamily: 'Arial'});
            this.tcText.push(tcText);
        } else {
            desc = tc_name + "\n" + hkt_map;
            var tcName = new OpenLayers.Feature.Vector(point, null, {
                label: desc,
                labelXOffset: 7,
                labelYOffset: 6,
                labelAlign: "lb",
                fontFamily: 'Arial'
            });
            //var tcName = new OpenLayers.Feature.Vector(point, null, {label: desc, labelXOffset: 7, labelYOffset: 6, labelAlign: "lb", fontWeight: 'bold', fontFamily: 'Arial'});
            this.tcName.push(tcName);
        }
    }

    function addCoastlineAndNameLayer() {
        var GIScoastlineLayer = new OpenLayers.Layer.OSM("Coastline", "/maps_weather/f4/osm-tiles/coastline/${z}/${x}/${y}.png", {
            transitionEffect: "resize",
            minZoomLevels: 4,
            numZoomLevels: 9,
        })
        map.addLayer(GIScoastlineLayer);
        $(GIScoastlineLayer.div).addClass("coastline");

        var iStyleMap = new OpenLayers.StyleMap({
            "default": new OpenLayers.Style({
                fillColor: "#f1eee9",   // Fill color for polygons
                fillOpacity: 1,         // Fill opacity
                strokeColor: "#000000", // Outline color
                strokeWidth: 1,         // Outline width
            })
        });
        var iLayer = new OpenLayers.Layer.Vector("others", {
            styleMap: iStyleMap,
        });
        map.addLayer(iLayer);
        var ifile = "/en/wxinfo/currwx/files/i.geojson";
        $.get(ifile, function (content) {
            var geojsonParser = new OpenLayers.Format.GeoJSON({
                internalProjection: map.getProjectionObject(),
                externalProjection: new OpenLayers.Projection("EPSG:4326")   // Source projection
            });
            var iFeatures = geojsonParser.read(content);
            iLayer.addFeatures(iFeatures);
        });

        var GISnameLayer = new OpenLayers.Layer.OSM("Place Name", "/maps_weather/f4/osm-tiles/placename/${z}/${x}/${y}.png", {
            transitionEffect: "resize",
            minZoomLevels: 4,
            numZoomLevels: 9
        })
        map.addLayer(GISnameLayer);
    }

    function addAlt() {
        $('body img:not([alt])').attr('alt', '');
        $('body .olControlZoomInItemInactive').attr('aria-label', 'Zoom In');
        $('body .olControlZoomInItemInactive').attr('tabindex', '0');
        $('body .olControlZoomOutItemInactive').attr('aria-label', 'Zoom Out');
        $('body .olControlZoomOutItemInactive').attr('tabindex', '0');
        $('body .olControlZoomToHomeItemInactive').attr('aria-label', 'Hong Kong');
        $('body .olControlZoomToHomeItemInactive').attr('tabindex', '0');
    }

    //===========================================================================
    // Initialize
    //===========================================================================
    var TC_Count;
    var TC_ID = [];
    var ENG = [];
    var CHI = [];
    var map;
    var tcText = [];
    var tcName = [];
    var allTcTextCheck;
    var allTc;

    if (typeof tc !== 'undefined') {
        TC_Count = tc.length;

        $(window).on("unload", function (e) {
            var coneStatus = document.getElementById('cone_check').checked;
            var textStatus = document.getElementById('text_check').checked;
            var satStatus = document.getElementById('sat_check').checked;
            var radStatus = document.getElementById('rad_check').checked;
            var boundaryStatus = document.getElementById('boundary_check').checked;
            setcookie("cone", coneStatus, 0);
            setcookie("sat", satStatus, 0);
            setcookie("rad", radStatus, 0);
            setcookie("boundary", boundaryStatus, 0);
            setcookie("time", textStatus, 0);
        });
        resetSelection();

        OpenLayers.INCHES_PER_UNIT["公里"] = OpenLayers.INCHES_PER_UNIT["km"];
        OpenLayers.INCHES_PER_UNIT["米"] = OpenLayers.INCHES_PER_UNIT["m"];

        function ToggleBoundaryLayer() {
            var checked = $('input[type=checkbox][id="boundary_check"]').is(":checked");
            tcBoundary.setVisibility(checked);
        }
        var selection_list = null;
        var lineLayer = null;
        var tcSat = null;
        var tcRad = null;
        var tcCone = null;
        var tcTrack = null;
        var pointStyle = null;
        var styleMap = null;
        var textLayer = null;
        var nameLayer = null;
        var allSelectedClass = "";
        var firstSelectedClass = "selected";

        const url = new URL(window.location.href);
        const params = new URLSearchParams(url.search);
        const viewValue = params.get('view');

        if (viewValue == 'all') {
            allSelectedClass = "selected";
            firstSelectedClass = "";
        } else {
            firstSelectedClass = "selected";
        }

        function buildTcList() {
            for (var i = 0; i < TC_Count; i = i + 1) {
                if (tc[i].length > 1) {
                    data_content = tc[i].split(",");
                    if (data_content.length == 3) {
                        TC_ID[i] = data_content[0];
                        ENG[i] = data_content[1];
                        CHI[i] = data_content[2];
                    }
                }
            }

            selection_list = "<select name=\"TDID\" onkeypress=\"handleEnter(this, event);\" onclick=\"go2page(this);\" onchange=\"go2page(this);\" title=\"Please select Tropical Cyclone\">";
            if (TC_Count > 1) {
                //No ALL selection when only one TC 
                selection_list += "<option value=\"0\" " + allSelectedClass + ">All</option>";
            }
            for (var i = 0; i < TC_Count; i++) {
                if (i == 0) {
                    selection_list += "<option value=\"" + TC_ID[i] + "\" " + firstSelectedClass + ">" + ENG[i] + "</option>";
                    default_value = TC_ID[i];
                } else {
                    selection_list += "<option value=\"" + TC_ID[i] + "\">" + ENG[i] + "</option>";
                }
            }
            selection_list += "</select>";
            document.getElementById('tc_selection').innerHTML = selection_list;

            lineLayer = new OpenLayers.Layer.Vector("Ref Line", {});
            map.addLayer(lineLayer);

            tcSat = new OpenLayers.Layer.Vector("Tc Sat", {});
            tcSat.setOpacity(0.6);
            map.addLayer(tcSat);

            tcRad = new OpenLayers.Layer.Vector("Tc Rad", {});
            tcRad.setOpacity(0.5);
            map.addLayer(tcRad);

            tcCone = new OpenLayers.Layer.Vector("Tc Cone", {});
            map.addLayer(tcCone);

            tcTrack = new OpenLayers.Layer.Vector("Tc Track", {});
            map.addLayer(tcTrack);

            pointStyle = new OpenLayers.Style({
                'label': "${label}",
                'labelXOffset': 7,
                'labelYOffset': 6,
                'labelAlign': "lb",
                //'fontWeight': 'bold',
                'fontFamily': 'Arial'
            }, {
                context: {
                    label: function (feature) {
                        // clustered features count or blank if feature is not a cluster
                        return feature.cluster[0] ? feature.cluster[0].style.label : "";
                    }
                }
            });

            styleMap = new OpenLayers.StyleMap({
                'default': pointStyle,
            });

            addCoastlineAndNameLayer();

            textLayer = new OpenLayers.Layer.Vector("Tc Label", {
                styleMap: styleMap,
                strategies: [new OpenLayers.Strategy.Cluster({
                    distance: 80
                })]
            });
            map.addLayer(textLayer);

            nameLayer = new OpenLayers.Layer.Vector("Tc Name Label", {});
            map.addLayer(nameLayer);

            if (TC_Count > 0) {
                var thisdate = new Date();
                var Cir400File = '/wxinfo/currwx/tc_gis_km400.txt';
                var Cir800File = '/wxinfo/currwx/tc_gis_km800.txt';

                DownloadUrl(Cir400File, cir_circle_400);
                DownloadUrl(Cir800File, cir_circle_800);
                if (viewValue == "all") {
                    drawInfoTable(TC_ID, -1);
                    for (var i = 0; i < TC_Count; i++) {
                        loadkml(i);
                        var posinfoFile = '/wxinfo/currwx/tc_gis_posinfo_15a_' + TC_ID[i] + '.txt';
                        var posinfoFile_des = '/wxinfo/currwx/tc_des_e_' + TC_ID[i] + '.xml';
                        DownloadUrl(posinfoFile, read_data);
                        read_data_des(posinfoFile_des);
                    }
                } else {
                    drawInfoTable(TC_ID, 0);
                    loadkml(0);
                    var posinfoFile = '/wxinfo/currwx/tc_gis_posinfo_15a_' + TC_ID[0] + '.txt';
                    var posinfoFile_des = '/wxinfo/currwx/tc_des_e_' + TC_ID[0] + '.xml';
                    DownloadUrl(posinfoFile, read_data);
                    read_data_des(posinfoFile_des);
                }
            }
            var featuresCtrlOptions = {
                hover: true,
                overFeature: function (e) {
                    clearpopup();
                    createpopup(e);
                },
                outFeature: function (e) {
                    clearpopup();
                },
                clickFeature: function (e) {
                    clearpopup();
                    createpopup(e);
                }
            };

            var selectControl = new OpenLayers.Control.SelectFeature([tcTrack], featuresCtrlOptions);
            map.addControl(selectControl);
            selectControl.activate();

            //button handling 
            var cone_btn = $('#cone_btn').on('click', function (e) {
                ToggleLayer('cone');
            });
            var text_btn = $('#text_btn').on('click', function (e) {
                ToggleLayer('text');
            });
            var sat_btn = $('#sat_btn').on('click', function (e) {
                ToggleLayer('sat');
            });
            var rad_btn = $('#rad_btn').on('click', function (e) {
                ToggleLayer('rad');
            });
            var boundary_btn = $('#boundary_btn').on('click', function (e) {
                ToggleLayer('boundary');
            });

            resetButton();
        }
    } else {
        $("#div_tc tbody").html("<tr><td><span style=\"color:#d70000;\">	When a tropical cyclone forms within or enters the area bounded by 7-36N and 100-140E, the Observatory will issue the first tropical cyclone track within two hours.</span><br><br></td></tr>");
    }
    //map

    map = new OpenLayers.MetGisMap('map', {
        minZoomLevels: 4,
        numZoomLevels: 15,
        zoom: 5,
        controls: [new OpenLayers.Control.Navigation(),
        new OpenLayers.Control.ZoomHomePanel(),
        new OpenLayers.Control.ArgParser(),
        new OpenLayers.Control.Attribution(),
        new OpenLayers.Control.ScaleLine1({
            bottomOutUnits: '',
            topOutUnits: "km",
            topInUnits: "m"
        })
        ],
        zoomToHome: function () {
            map.setCenter(
                new OpenLayers.LonLat(114.213, 22.1467).transform(
                    new OpenLayers.Projection("EPSG:4326"),
                    map.getProjectionObject()
                ),
                5 //map.zoom
            );
        },
        allOverlays: true, //key for multiple OSM layers
        useCommonBaseLayer: function () {
            var map = this;

            function failbackToOSM() {
                var osm = new OpenLayers.Layer.OSM("OpenStreetMap", "/maps_weather/f4/osm-tiles/detail/${z}/${x}/${y}.png", {
                    transitionEffect: "resize",
                    minZoomLevels: 4,
                    numZoomLevels: 9
                })
                map.addLayer(osm);
                map.setBaseLayer(osm);
            }
            try {
                if (window.google && google.maps) {
                    var baseMap = new OpenLayers.Layer.Google("GoogleStreets", {
                        sphericalMercator: true,
                        type: google.maps.MapTypeId.TERRAIN,
                        minZoomLevels: 4,
                        numZoomLevels: 9
                    });
                    map.addLayer(baseMap);

                    var googleFailbackTimeout = setTimeout(function () {
                        map.removeLayer(baseMap);
                        failbackToOSM();
                    }, 20000);
                    google.maps.event.addListener(baseMap.mapObject, 'tilesloaded', function () {
                        clearTimeout(googleFailbackTimeout);
                        if (map.baseLayer != baseMap)
                            return;

                    }); // END of tilesloaded
                }
            } catch (e) {
                console.log(e);
            }
            if (!map.baseLayer) {
                failbackToOSM();
            }
        }
    });

    var osm = new OpenLayers.Layer.OSM("OpenStreetMap", "/maps_weather/f4/osm-tiles/detail/${z}/${x}/${y}.png", {
        transitionEffect: "resize",
        minZoomLevels: 4,
        numZoomLevels: 9
    })
    map.addLayer(osm);
    map.setBaseLayer(osm);

    map.setCenter(
        new OpenLayers.LonLat(114.213, 22.1467).transform(
            new OpenLayers.Projection("EPSG:4326"),
            map.getProjectionObject()
        )
    );

    var tcBoundary = new OpenLayers.Layer.Vector("Tc Track Boundary", {
        visibility: true,
        strategies: [new OpenLayers.Strategy.Fixed()],
        protocol: new OpenLayers.Protocol.HTTP({
            url: "/wxinfo/currwx/tc_track_boundary.kml",
            format: new OpenLayers.Format.KML2()
        })
    });
    map.addLayer(tcBoundary);

    if (typeof (tc) === 'undefined' || tc.length == 0) {
        tcBoundary.setVisibility(document.getElementById('boundary_check').checked);
        addCoastlineAndNameLayer();
    } else {
        buildTcList();
    }

    var checkForGoogleMapError = setInterval(function () {
        if ($('#map').find('.gm-err-container').length || $('#map_sdacanvas').find('.gm-err-container').length) {
            var osm = new OpenLayers.Layer.OSM("OpenStreetMap", "/maps_weather/f4/osm-tiles/detail/${z}/${x}/${y}.png", {
                transitionEffect: "resize",
                minZoomLevels: 4,
                numZoomLevels: 9
            })

            // Remove the Google base layer
            map.baseLayer = null;

            map.addLayer(osm);
            map.setBaseLayer(osm);

            // Reset map center and zoom
            map.setCenter(
                new OpenLayers.LonLat(114.213, 22.1467).transform(
                    new OpenLayers.Projection("EPSG:4326"),
                    map.getProjectionObject()
                ),
                5
            );

            clearInterval(checkForGoogleMapError);
        }
    }, 100);

    setTimeout(function () {
        clearInterval(checkForGoogleMapError);
    }, 60000);

    addAlt();

    const zoomins = document.querySelectorAll('.olControlZoomInItemInactive');
    const zoomouts = document.querySelectorAll('.olControlZoomOutItemInactive');
    const homes = document.querySelectorAll('.olControlZoomToHomeItemInactive');

    zoomins.forEach(zoomin => {
        zoomin.addEventListener('keydown', function () {
            if (event.key === 'Enter') {
                $('body').find(".olControlZoomInItemInactive").click();
            }
        });
    });

    zoomouts.forEach(zoomout => {
        zoomout.addEventListener('keydown', function () {
            if (event.key === 'Enter') {
                $('body').find(".olControlZoomOutItemInactive").click();
            }
        });
    });

    homes.forEach(home => {
        home.addEventListener('keydown', function () {
            if (event.key === 'Enter') {
                $('body').find(".olControlZoomToHomeItemInactive").click();
            }
        });
    });
</script>
<script>var last_revision_date = '19 February 2025';</script>
                </div>
				<!--End Content-->
                </div>
            </div>
            <script type="text/javascript">pageBottom();</script>
        </div>
    </div>
    <div id="footer" class="footerArea">
        <div class="container"> 
			<script type="text/javascript">createFooter();</script>
        </div>
    </div>
</div>
</body>
</html>